"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }// src/vite.ts
var _vite = require('vite');

// src/handler/build.ts
var _path = require('path');
var assetPatterns = [
  ["media", /\.(mp4|webm|ogg|mp3|wav|flac|aac|swf)(\?.*)?$/i],
  ["image", /\.(png|jpe?g|gif|ico|svg|webp)(\?.*)?$/i],
  ["font", /\.(woff2?|eot|ttf|otf)(\?.*)?$/i],
  ["css", /\.(s?css|less|styl)(\?.*)?$/i]
];
var handleBuild = (config) => {
  config.build ||= {};
  config.build.rollupOptions ||= {};
  config.build.rollupOptions.output ||= {};
  const keys = Object.keys(config.build.rollupOptions.output);
  const overrideKeys = [
    "assetFileNames",
    "chunkFileNames",
    "entryFileNames"
  ];
  const userDefined = keys.some((key) => overrideKeys.includes(key));
  if (!userDefined) {
    config.build.rollupOptions.output = {
      ...config.build.rollupOptions.output,
      assetFileNames(assetInfo) {
        const ext = _path.extname.call(void 0, assetInfo.name || "");
        let prefix = "misc";
        for (const [name, pattern] of assetPatterns) {
          if (pattern.test(ext)) {
            prefix = name;
            break;
          }
        }
        return `${prefix}/[name].[hash][extname]`;
      },
      chunkFileNames: "js/[name].[hash].js",
      entryFileNames: "js/entry-[name].[hash].js"
    };
  }
};

// src/handler/css.ts
var handleCss = (config, env) => {
  config.css ||= {};
  if (config.css.modules === false)
    return;
  config.css.modules ||= {};
  config.css.modules.generateScopedName ??= env.command === "build" ? "[hash:base64]" : "[path][name]-[ext]___[local]";
};

// src/handler/html.ts
var _vitepluginhtml = require('vite-plugin-html');
var handleHtml = (config, env) => {
  if (config.html === false)
    return;
  config.html ||= {};
  config.html.minify ??= env.command === "build";
  config.plugins ||= [];
  config.plugins.push(_vitepluginhtml.createHtmlPlugin.call(void 0, config.html));
};

// src/handler/legacy.ts
var _pluginlegacy = require('@vitejs/plugin-legacy'); var _pluginlegacy2 = _interopRequireDefault(_pluginlegacy);
var handleLegacy = (config) => {
  if (!config.legacy)
    return;
  config.plugins ||= [];
  config.plugins.push(_pluginlegacy2.default.call(void 0, config.legacy === true ? void 0 : config.legacy));
};

// src/handler/mix.ts
var handleMix = (config) => {
  config.base ??= "./";
  config.clearScreen ??= false;
};

// src/handler/react.ts
var _pluginreact = require('@vitejs/plugin-react'); var _pluginreact2 = _interopRequireDefault(_pluginreact);
var _pluginreactswc = require('@vitejs/plugin-react-swc'); var _pluginreactswc2 = _interopRequireDefault(_pluginreactswc);
var handleReact = (config) => {
  config.plugins ||= [];
  config.react ||= {};
  if (config.react.swc !== false) {
    config.plugins.push(_pluginreactswc2.default.call(void 0, omit(config.react)));
  } else {
    config.plugins.push(_pluginreact2.default.call(void 0, omit(config.react)));
  }
};
var omit = (config) => {
  delete config.swc;
  return config;
};

// src/handler/resolve.ts
var _vitetsconfigpaths = require('vite-tsconfig-paths'); var _vitetsconfigpaths2 = _interopRequireDefault(_vitetsconfigpaths);
var handleResolve = (config) => {
  const { aliasFromTsconfig = true } = config.resolve || {};
  if (aliasFromTsconfig) {
    config.plugins ||= [];
    config.plugins.push(_vitetsconfigpaths2.default.call(void 0, aliasFromTsconfig === true ? void 0 : aliasFromTsconfig));
  }
};

// src/handler/server.ts
var _vitepluginrestart = require('vite-plugin-restart'); var _vitepluginrestart2 = _interopRequireDefault(_vitepluginrestart);
var _pluginbasicssl = require('@vitejs/plugin-basic-ssl'); var _pluginbasicssl2 = _interopRequireDefault(_pluginbasicssl);
var _vitepluginqrcode = require('vite-plugin-qrcode');
var handleServer = (config) => {
  config.server ||= {};
  config.preview ||= {};
  config.server.open ??= true;
  config.plugins ||= [];
  if (config.server.https === true || config.preview.https === true) {
    config.plugins.push(_pluginbasicssl2.default.call(void 0, ));
  }
  const { watchExtend } = config.server;
  if (watchExtend) {
    config.plugins.push(_vitepluginrestart2.default.call(void 0, watchExtend));
  }
  const { qrcode = true } = config.server;
  if (qrcode) {
    config.plugins.push(_vitepluginqrcode.qrcode.call(void 0, qrcode === true ? void 0 : qrcode));
  }
};

// src/vite.ts
var defineConfig = (config = {}) => {
  return _vite.defineConfig.call(void 0, (env) => {
    return parseConfig(typeof config === "function" ? config(env) : config, env);
  });
};
var parseConfig = (config, env) => {
  var _a, _b, _c;
  handleReact(config);
  delete config.react;
  handleLegacy(config);
  delete config.legacy;
  handleCss(config, env);
  handleBuild(config);
  handleMix(config);
  handleServer(config);
  (_a = config.server) == null ? true : delete _a.watchExtend;
  (_b = config.server) == null ? true : delete _b.qrcode;
  handleHtml(config, env);
  delete config.html;
  handleResolve(config);
  (_c = config.resolve) == null ? true : delete _c.aliasFromTsconfig;
  return config;
};


exports.defineConfig = defineConfig;
//# sourceMappingURL=index.cjs.map